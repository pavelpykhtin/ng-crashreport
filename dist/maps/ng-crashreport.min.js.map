{"version":3,"sources":["ng-crashreport.module.js","exceptionHandler.js","logService.js"],"names":["angular","module","ExceptionHandler","$log","logService","init","window","onerror","onError","messageText","url","lineNumber","columnNumber","errorObject","self","throttling","errorDescriptor","getErrorDescriptor","lastError","clearTimeout","throttleTimer","setTimeout","throttleTimeout","logException","this","exception","cause","error","message","stack","service","$inject","LogService","$injector","options","_options","extend","defaultOptions","urls","parseUrl","log","fallbackStep","resultMessage","Version","applicationVersion","http","get","post","currentUrlIndex","application","then","result","length","trace","additionalInformation","TimeStamp","LogLevel","logLevels","Trace","MessageText","StackTrace","AdditionalInformation","JSON","stringify","InnerException","formattedMessage","currentLocation","location","href","userAgent","navigator","Fatal","console","Object","prototype","toString","call","split","i","replace","splice","Error","Warn","Info","Debug"],"mappings":"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","file":"../ng-crashreport.min.js","sourcesContent":["(function() {\r\n\tangular.module('ngCrashReport', []);\r\n})();","(function() {\r\n\tangular.module('ngCrashReport')\r\n\t\t.service('$exceptionHandler', ExceptionHandler);\r\n\r\n\tExceptionHandler.$inject = ['$log', 'logService'];\r\n\tfunction ExceptionHandler($log, logService) {\r\n\t\tvar self = this;\r\n\r\n\t\tself.throttling = true;\r\n\t\tself.throttleTimeout = 2000;\r\n\t\tself.lastError = null;\r\n\t\tself.throttleTimer = null;\r\n\r\n\t\tinit();\r\n\r\n\t\tfunction init() {\r\n\t\t\twindow.onerror = onError;\r\n\t\t}\r\n\r\n\t\tfunction onError(messageText, url, lineNumber, columnNumber, errorObject) {\r\n\t\t\tif (self.throttling) {\r\n\t\t\t\tvar errorDescriptor = getErrorDescriptor(messageText, url, lineNumber, columnNumber);\r\n\r\n\t\t\t\tif (errorDescriptor == self.lastError)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tclearTimeout(self.throttleTimer);\r\n\t\t\t\tself.throttleTimer = setTimeout(function () { self.lastError = null; }, self.throttleTimeout);\r\n\r\n\t\t\t\tself.lastError = errorDescriptor;\r\n\t\t\t}\r\n\r\n\t\t\tlogService.logException(messageText, url, lineNumber, columnNumber, errorObject);\r\n\t\t};\r\n\r\n\t\tfunction getErrorDescriptor(messageText, url, lineNumber, columnNumber) {\r\n\t\t\treturn messageText + url + lineNumber + columnNumber;\r\n\t\t}\r\n\r\n\t\treturn function(exception, cause) {\r\n\t\t\t$log.error(exception);\r\n\r\n\t\t\tonError(exception.message + '\\r\\n' + cause, null, null, null, { stack: exception.stack });\r\n\t\t}\r\n\t}\r\n})();","(function () {\r\n\tangular.module('ngCrashReport')\r\n\t\t.service('logService', LogService);\r\n\r\n\tLogService.$inject = ['$injector', 'ngCrashReportSettings'];\r\n\tfunction LogService($injector, options) {\r\n\t\tvar self = this;\r\n\r\n\t\tvar defaultOptions = {\r\n\t\t\turl: '',\r\n\t\t\tapplication: 'Unknown',\r\n\t\t\tapplicationVersion: '0.0'\r\n\t\t}\r\n\t\tvar currentUrlIndex = 0;\r\n\t\tvar _options;\r\n\t\t\r\n\t\tself.log = log;\r\n\t\tself.trace = trace;\r\n\t\tself.logException = logException;\r\n\r\n\t\tvar logLevels = {\r\n\t\t\tFatal: 0,\r\n\t\t\tError: 1,\r\n\t\t\tWarn: 2,\r\n\t\t\tInfo: 3,\r\n\t\t\tDebug: 4,\r\n\t\t\tTrace: 5\r\n\t\t};\r\n\r\n\t\tinit();\r\n\r\n\t\tfunction init() {\r\n\t\t\t_options = angular.extend({}, defaultOptions, options);\r\n\r\n\t\t\t_options.urls = parseUrl(_options.url);\r\n\t\t}\r\n\r\n\t\tfunction log(message, fallbackStep) {\r\n\t\t\tfallbackStep = fallbackStep || 0;\r\n\r\n\t\t\tvar resultMessage = angular.extend({\r\n\t\t\t\tVersion: _options.applicationVersion\r\n\t\t\t}, message);\r\n\r\n\t\t\tvar http = $injector.get('$http');\r\n\r\n\t\t\treturn http\r\n\t\t\t\t.post(\r\n\t\t\t\t\t_options.urls[currentUrlIndex] + '/api/' + _options.application + '/log',\r\n\t\t\t\t\tresultMessage)\r\n\t\t\t\t.then(\r\n\t\t\t\t\tfunction () { },\r\n\t\t\t\t\tfunction (result) {\r\n\t\t\t\t\t\tif (fallbackStep + 1 < _options.urls.length) {\r\n\t\t\t\t\t\t\tcurrentUrlIndex++;\r\n\t\t\t\t\t\t\treturn log(message, fallbackStep + 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t});\r\n\t\t};\r\n\r\n\t\tfunction trace(messageText, additionalInformation) {\r\n\t\t\tvar message = {\r\n\t\t\t\tTimeStamp: null,\r\n\t\t\t\tLogLevel: logLevels.Trace,\r\n\t\t\t\tMessageText: messageText,\r\n\t\t\t\tStackTrace: null,\r\n\t\t\t\tAdditionalInformation: additionalInformation ? JSON.stringify(additionalInformation) : null,\r\n\t\t\t\tInnerException: null\r\n\t\t\t}\r\n\r\n\t\t\treturn self.log(message);\r\n\t\t};\r\n\r\n\t\tfunction logException(messageText, url, lineNumber, columnNumber, errorObject) {\r\n\t\t\tvar formattedMessage = messageText + '\\r\\n[' + url + '] [' + lineNumber + ':' + columnNumber + ']';\r\n\t\t\tvar additionalInformation = {\r\n\t\t\t\tcurrentLocation: window.location.href,\r\n\t\t\t\tuserAgent: navigator.userAgent\r\n\t\t\t};\r\n\r\n\t\t\tvar message = {\r\n\t\t\t\tTimeStamp: null,\r\n\t\t\t\tLogLevel: logLevels.Fatal,\r\n\t\t\t\tMessageText: formattedMessage,\r\n\t\t\t\tStackTrace: (errorObject.stack || 'no stack available'),\r\n\t\t\t\tAdditionalInformation: JSON.stringify(additionalInformation),\r\n\t\t\t\tInnerException: null\r\n\t\t\t}\r\n\r\n\t\t\treturn self.log(message);\r\n\t\t};\r\n\r\n\t\tfunction parseUrl(url) {\r\n\t\t\tif(!url)\r\n\t\t\t\tconsole.error('Url must be provided!');\r\n\r\n\t\t\tswitch(Object.prototype.toString.call(url)) {\r\n\t\t\t\tcase '[object Array]':\r\n\t\t\t\t\treturn url;\r\n\t\t\t\tcase '[object String]':\r\n\t\t\t\t\tvar urls = url.split(';');\r\n\t\t\t\t\tvar i = 0;\r\n\t\t\t\t\twhile (i < urls.length) {\r\n\t\t\t\t\t\turls[i] = urls[i].replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\r\n\r\n\t\t\t\t\t\tif (urls[i]) {\r\n\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\turls.splice(i, 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn urls;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.error('Collection of urls must be a string or an array');\r\n\t\t\t}\r\n\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n})();"]}